import os

import matplotlib.pyplot as plt
import numpy as np
import pandas as pd
from sklearn.decomposition import PCA

from Refinement import procrustes_analysis as pa
from Tools import config as cfg


def run(data, model=cfg.models[0]):
    pca_, pca_data, ls = calculate_pca(data=data)
    show_shapes(ls)

    plot_variance(pca_, pca_data, ls)
    plot_principal_modes(pca_, ls)

    # Save the PCA object (model)
    model_directory, modelFilename = os.path.split(model)  # which model?
    if not os.path.exists(model_directory):
        os.makedirs(model_directory)

    pca_file = open(model, 'wb')
    pickle.dump(pca_, pca_file, pickle.HIGHEST_PROTOCOL)

    # reading the file created
    # pca_file2 = open(model, 'rb')
    # pca_2 = pickle.load(pca_file2)
    # mean = pca_2.mean_
    # print('MODEL', mean.shape)
    # plot_principal_modes(pca_2, ls)


def calculate_pca(data):
    list_shapes, matrix_shapes = pa.procrustes_analysis(data)
    pca = PCA(cfg.pca_variance)
    pca_data = pca.fit_transform(matrix_shapes)
    return pca, pca_data, list_shapes


def plot_principal_modes(pca, ls):
    """
    # Variance
    fig, ax = plt.subplots(1, 2)
    ax[0].bar(np.arange(5), height=pca.explained_variance_ratio_ * 100)
    ax[0].set_ylabel('Variance explanation factor (percent)')
    ax[0].set_xlabel('Eigenvalue')
    ax[1].plot(pca.explained_variance_ratio_)
    ax[1].set_ylabel('Variance explanation factor')
    ax[1].set_xlabel('Eigenvalue')

    print('Variation:', sum(pca.explained_variance_ratio_))
    print(pca.explained_variance_ratio_)
    plt.show()
    """

    # Forma promedio y sus variaciones
    shape_ = ls[0].shape
    fig, arr = plt.subplots(3, 3)
    pca_mean = np.reshape(pca.mean_, shape_)

    pca_m_x, pca_m_y = pca_mean.T
    for i in range(3):
        component_i_a = pca.mean_ + pca.components_[i] * (-3 * np.sqrt(pca.explained_variance_[i]))
        component_i_b = pca.mean_ + pca.components_[i] * (3 * np.sqrt(pca.explained_variance_[i]))

        c_i_a = np.reshape(component_i_a, shape_)
        c_i_b = np.reshape(component_i_b, shape_)
        c_ia_x, c_ia_y = c_i_a.T
        c_ib_x, c_ib_y = c_i_b.T

        arr[i][0].plot(c_ia_x, -c_ia_y, 'b')
        arr[i][0].set_title(r'$b_%2d = -3\sqrt{\lambda_%2d}$' % (i + 1, i + 1))
        arr[i][0].axis('off')
        arr[i][1].plot(pca_m_x, -pca_m_y, 'r')
        arr[i][1].set_title(r'$b_%2d = 0$' % (i + 1))
        arr[i][1].axis('off')
        arr[i][2].plot(c_ib_x, -c_ib_y, 'b')
        arr[i][2].set_title(r'$b_%2d = +3\sqrt{\lambda_%2d}$' % (i + 1, i + 1))
        arr[i][2].axis('off')
    plt.show()


def plot_variance(pca, pca_data, ls):
    name_shapes = ['Shape' + str(x) for x in range(1, len(ls) + 1)]

    per_var = np.round(pca.explained_variance_ratio_ * 100, decimals=2)
    per_var = np.cumsum(per_var)

    labels = ['PC' + str(x) for x in range(1, len(per_var) + 1)]

    plt.bar(x=range(1, len(per_var) + 1), height=per_var, tick_label=labels)
    plt.xticks(range(1, len(per_var) + 1), labels)
    plt.ylabel('Percentage of Total Variance Explained')
    plt.xlabel('Principal Component')
    plt.show()

    plt.plot(range(1, len(per_var) + 1), per_var, 'o-', ms=5, lw=1.3)
    plt.axhline(97, linestyle='--', color='m', lw=0.7)
    plt.ylabel('Percentage of Total Variance Explained')
    plt.xlabel('Principal Component')
    plt.show()

    # Grafico de dispersion o PC1 - PC2
    pca_df = pd.DataFrame(pca_data, index=name_shapes, columns=labels)
    plt.scatter(pca_df.PC1, pca_df.PC2)
    # plt.title('My PCA Graph: PC1 vs PC2')
    plt.xlabel('PC1 - {0}%'.format(per_var[0]))
    plt.ylabel('PC2 - {0}%'.format(per_var[1]))
    plt.axhline(0, color='b')
    plt.axvline(0, color='b')

    for name in name_shapes:
        plt.annotate(name, (pca_df.PC1.loc[name], pca_df.PC2.loc[name]))

    # plt.grid(color='r', lw=1, linestyle='--')
    plt.show()


def show_shapes(shapes):
    mean_shape = np.mean(shapes, axis=0)
    m_x, m_y = mean_shape.T

    for shape in shapes:
        sx, sy = shape.T
        plt.plot(sx, -sy, 'r-', lw=1)
    plt.plot(m_x, -m_y, 'b-', label='Mean Shape', lw=3)
    plt.legend()
    plt.axis('off')
    plt.show()


if __name__ == '__main__':
    data = np.array([[(141.33333333333334, 610.6666666666666), (148.0, 604.0), (155.33333333333334, 598.6666666666666),
                      (163.33333333333334, 592.0), (169.33333333333334, 584.0), (172.66666666666666, 575.3333333333334),
                      (174.66666666666666, 566.6666666666666), (173.5, 556.5), (168.66666666666666, 548.0),
                      (165.33333333333334, 540.0), (168.0, 533.0), (172.0, 527.5), (176.0, 521.5), (181.5, 515.5),
                      (186.5, 509.5), (190.5, 504.0), (196.5, 499.5), (202.5, 495.0), (209.0, 492.0), (219.0, 493.5),
                      (231.0, 495.0), (244.0, 495.5), (254.0, 489.0), (262.5, 480.0), (268.5, 471.5), (274.0, 462.5),
                      (275.5, 451.0), (275.5, 438.0), (274.0, 418.5), (273.0, 406.5), (267.5, 396.5), (259.5, 387.5),
                      (249.0, 381.0), (238.0, 376.5), (226.0, 373.5), (214.0, 372.5), (200.5, 374.5), (187.5, 378.5),
                      (176.5, 384.0), (166.0, 392.5), (160.0, 402.5), (155.5, 414.0), (149.5, 422.5), (138.5, 425.0),
                      (126.0, 425.0), (115.5, 424.5), (105.5, 420.0), (99.5, 414.0), (91.5, 405.5), (81.0, 400.0),
                      (70.5, 399.5), (61.5, 410.0), (51.0, 420.5), (43.5, 431.0), (38.5, 443.5), (31.0, 456.0),
                      (26.0, 468.0),
                      (22.5, 483.0), (25.5, 496.5), (32.5, 507.0), (37.5, 517.5), (41.5, 528.5), (44.5, 540.5),
                      (46.5, 552.0),
                      (48.0, 563.0), (49.0, 574.5), (50.0, 585.0), (51.0, 598.0), (51.0, 609.0)],
                     [(135.0, 431.0), (139.5, 425.5), (143.5, 421.0), (147.0, 416.0), (150.0, 411.5), (152.5, 405.5),
                      (153.5, 400.0), (153.5, 393.5), (150.0, 388.5), (146.0, 383.0), (148.5, 378.5), (150.5, 374.5),
                      (152.0, 370.0), (155.0, 366.0), (158.5, 362.5), (161.0, 358.0), (164.0, 354.5), (169.0, 352.0),
                      (174.5, 351.0), (183.6, 352.4), (192.0, 351.6), (199.6, 346.0), (205.2, 339.6), (209.6, 331.2),
                      (212.0, 322.4), (212.4, 312.0), (210.8, 302.8), (206.8, 293.6), (201.6, 287.6), (198.0, 280.0),
                      (192.0, 275.6), (184.8, 271.2), (175.6, 268.8), (166.0, 268.0), (157.6, 268.4), (149.6, 269.6),
                      (142.0, 273.2), (136.4, 277.6), (132.4, 282.4), (128.4, 287.6), (125.6, 293.6), (125.2, 300.8),
                      (121.2, 306.0), (115.6, 311.2), (106.4, 311.2), (97.6, 309.6), (88.4, 306.0), (82.8, 299.6),
                      (78.8, 292.0), (67.2, 290.4), (56.8, 290.8), (50.4, 296.4), (50.8, 305.6), (47.2, 315.6),
                      (44.8, 324.8),
                      (41.2, 334.8), (37.6, 344.0), (35.2, 354.8), (36.4, 364.8), (41.6, 369.6), (46.8, 375.6),
                      (49.6, 381.2),
                      (52.8, 387.6), (56.8, 394.0), (58.8, 401.2), (61.6, 408.4), (63.2, 416.4), (64.8, 423.6),
                      (64.8, 430.0)],
                     [(142.0, 532.0), (145.0, 525.5), (150.5, 520.0), (153.0, 514.0), (156.5, 507.5), (158.5, 500.5),
                      (158.5, 493.5), (156.5, 487.5), (152.5, 481.5), (147.33333333333334, 476.0), (151.5, 466.5),
                      (154.0, 455.5), (156.5, 445.5), (159.0, 435.0), (163.0, 425.0), (169.0, 415.5), (176.0, 405.5),
                      (187.0, 397.5), (199.5, 392.0), (207.5, 389.5), (215.5, 386.5), (221.5, 380.0), (226.0, 374.0),
                      (229.0, 366.0), (230.5, 358.0), (231.0, 350.5), (230.5, 342.5), (229.5, 333.5), (222.0, 321.0),
                      (215.5, 312.0), (207.0, 306.0), (198.0, 301.0), (188.0, 298.0), (178.5, 297.0), (167.0, 298.0),
                      (157.5, 300.5), (149.5, 304.5), (142.0, 309.0), (135.0, 316.0), (129.5, 323.0), (128.0, 332.5),
                      (129.0, 342.5), (128.5, 352.5), (122.5, 360.5), (113.0, 367.5), (101.5, 370.5), (88.0, 372.0),
                      (78.0, 365.5), (69.0, 359.5), (57.0, 356.0), (47.0, 359.5), (41.0, 369.0), (37.0, 382.5),
                      (34.5, 394.5),
                      (30.0, 405.5), (26.0, 416.0), (22.0, 427.5), (23.5, 439.0), (27.0, 451.0), (35.5, 459.5),
                      (41.5, 465.0),
                      (46.0, 472.5), (50.5, 480.0), (54.5, 489.5), (57.0, 498.5), (60.5, 506.5), (62.0, 515.5),
                      (64.5, 523.5),
                      (66.5, 532.5)],
                     [(174.66666666666666, 521.3333333333334), (179.5, 517.5), (185.0, 513.5), (189.5, 508.5),
                      (192.5, 503.5),
                      (192.0, 498.0), (192.5, 492.5), (189.5, 488.5), (186.5, 483.5),
                      (184.66666666666666, 477.3333333333333),
                      (185.0, 470.5), (187.5, 464.0), (190.5, 458.5), (193.5, 452.5), (197.5, 446.5), (202.0, 441.0),
                      (207.0, 436.0), (213.5, 431.0), (221.0, 428.0), (230.5, 428.5), (239.5, 427.5), (248.0, 425.5),
                      (256.0, 421.0), (262.0, 415.5), (267.5, 408.5), (270.5, 400.0), (269.5, 391.5), (266.5, 383.0),
                      (262.5, 366.0), (260.5, 355.5), (254.5, 348.5), (246.0, 342.5), (236.0, 337.5), (225.0, 336.0),
                      (215.0, 336.5), (205.5, 337.0), (196.0, 341.0), (189.5, 345.0), (182.0, 351.0), (177.5, 358.0),
                      (173.5, 366.5), (171.5, 375.0), (168.0, 382.0), (162.5, 389.5), (154.0, 394.5), (144.5, 397.0),
                      (133.0, 398.5), (122.5, 396.0), (116.0, 387.0), (109.0, 377.0), (99.5, 372.5), (92.0, 379.0),
                      (85.5, 388.5), (81.5, 399.0), (76.5, 409.0), (74.0, 420.0), (71.0, 431.0), (68.0, 442.5),
                      (71.5, 454.0),
                      (78.0, 464.0), (82.0, 471.0), (85.5, 477.0), (88.5, 482.5), (90.5, 488.0), (93.5, 494.5),
                      (95.0, 501.0),
                      (96.5, 508.5), (97.0, 515.5), (98.5, 522.5)],
                     [(158.66666666666666, 516.6666666666666), (163.0, 511.5), (170.5, 506.5), (176.5, 501.5),
                      (179.0, 494.0),
                      (180.5, 486.5), (179.5, 478.0), (176.5, 471.0), (172.5, 464.0), (167.0, 457.5), (170.5, 450.0),
                      (173.5, 443.5), (177.5, 437.0), (181.0, 431.5), (185.5, 426.0), (189.5, 421.5), (194.5, 417.0),
                      (201.0, 416.0), (209.0, 415.0), (219.0, 417.5), (227.5, 416.0), (235.0, 411.5), (240.5, 403.0),
                      (246.0, 395.0), (249.0, 385.0), (252.0, 374.5), (252.0, 366.0), (249.0, 358.0), (247.5, 346.0),
                      (243.0, 339.5), (237.0, 332.0), (229.0, 325.0), (219.5, 321.5), (208.5, 319.5), (197.5, 318.5),
                      (186.5, 318.5), (176.0, 322.5), (166.5, 328.5), (158.5, 335.5), (152.0, 343.0), (147.0, 353.5),
                      (147.5, 365.5), (141.5, 371.5), (135.0, 374.0), (127.0, 377.0), (119.0, 379.0), (110.0, 380.5),
                      (101.0, 378.5), (92.5, 372.0), (87.5, 366.0), (78.0, 362.5), (73.0, 368.0), (67.5, 375.5),
                      (63.5, 384.0), (59.5, 393.5), (55.0, 403.5), (51.5, 414.0), (51.5, 425.5), (51.0, 436.5),
                      (59.5, 444.0),
                      (64.0, 450.5), (70.0, 458.5), (73.5, 465.5), (77.0, 472.0), (80.0, 481.0), (82.5, 490.0),
                      (84.0, 498.0),
                      (86.0, 506.0), (87.5, 515.0)]])

    data_ = np.array([[(121.0, 302.0), (129.0, 304.0), (136.5, 307.5), (142.5, 313.5), (145.5, 321.5), (149.5, 328.0),
                       (155.5, 335.0), (158.0, 343.0), (159.5, 352.0), (162.5, 361.5), (163.5, 370.5), (169.6, 369.2),
                       (176.4, 368.8), (184.8, 366.4), (192.4, 365.2), (199.6, 364.4), (206.8, 363.6), (214.4, 363.2),
                       (222.4, 363.6), (230.4, 365.6), (238.0, 367.2), (245.6, 369.6), (250.8, 373.6), (256.8, 377.2),
                       (262.4, 380.8), (268.4, 384.8), (274.0, 388.8), (278.8, 393.6), (282.0, 398.0), (286.0, 403.2),
                       (289.6, 408.4), (292.4, 414.4), (295.6, 420.0), (296.4, 425.6), (296.8, 431.6), (296.8, 438.0),
                       (296.4, 443.6), (299.2, 449.6), (303.6, 455.6), (308.8, 461.2), (308.8, 467.2), (263.2, 480.4),
                       (262.5, 491.5), (261.0, 505.0), (264.0, 519.0), (267.0, 530.5), (271.5, 542.0), (278.5, 550.0),
                       (288.0, 556.0), (298.5, 563.5), (311.0, 572.5), (323.0, 578.5), (338.0, 580.5), (352.0, 584.5),
                       (365.5, 587.5), (378.0, 584.0), (386.5, 572.0), (398.0, 561.0), (405.0, 550.5), (415.0, 541.0),
                       (429.0, 536.5), (445.0, 530.0), (447.0, 514.5), (448.5, 498.0), (449.5, 481.5), (447.0, 467.5),
                       (436.5, 468.5), (425.0, 468.0), (415.0, 467.5), (403.5, 466.0), (393.5, 463.5), (383.5, 459.0),
                       (374.5, 454.0), (365.5, 448.5), (358.0, 441.0), (352.0, 434.0), (346.0, 426.0), (340.0, 420.5),
                       (335.5, 412.5), (329.0, 405.5), (324.5, 397.5), (318.5, 389.5), (313.5, 381.5), (308.0, 374.5),
                       (303.5, 366.5), (298.5, 358.0), (294.5, 350.5), (289.0, 342.0), (286.5, 333.0), (284.0, 324.5),
                       (282.0, 315.5), (282.0, 305.0), (285.5, 295.5), (293.0, 286.0), (295.0, 280.0)],
                      [(109.5, 189.0), (115.0, 195.5), (118.0, 203.5), (123.0, 210.5), (125.5, 217.0), (127.5, 224.5),
                       (129.5, 232.0), (132.0, 239.5), (135.0, 246.0), (133.0, 254.5), (128.66666666666666, 262.0),
                       (134.0, 267.0), (140.5, 265.0), (145.5, 263.5), (150.5, 262.0), (156.0, 261.2), (162.4, 258.8),
                       (168.0, 257.5), (174.0, 258.4), (179.5, 260.5), (184.0, 262.4), (189.5, 265.5), (194.0, 268.4),
                       (198.8, 272.8), (203.6, 274.0), (208.8, 275.2), (212.4, 279.6), (215.6, 284.8), (217.6, 289.6),
                       (219.2, 294.8), (222.5, 298.0), (224.0, 302.5), (225.5, 308.0), (225.0, 314.5), (227.5, 319.0),
                       (229.0, 325.0), (231.5, 330.5), (232.5, 335.0), (233.0, 339.5), (234.0, 343.5), (231.0, 347.5),
                       (192.5, 355.5), (191.5, 364.5), (193.0, 372.5), (195.5, 381.5), (198.5, 390.5), (202.0, 399.0),
                       (206.5, 408.0), (213.0, 417.0), (222.5, 419.5), (234.5, 422.5), (244.0, 426.5), (254.5, 427.5),
                       (265.0, 427.5), (276.5, 422.0), (285.0, 415.0), (293.5, 407.0), (301.5, 399.5), (309.0, 392.0),
                       (314.0, 382.5), (320.5, 373.5), (328.5, 362.5), (329.0, 347.5), (330.5, 333.0), (330.0, 319.5),
                       (330.0, 304.0), (325.5, 300.0), (318.0, 299.5), (311.5, 300.0), (304.5, 301.5), (298.5, 300.0),
                       (292.5, 298.5), (286.5, 296.5), (280.5, 292.5), (274.5, 288.0), (268.0, 284.5), (261.5, 281.5),
                       (254.5, 277.5), (250.0, 272.5), (245.5, 268.5), (241.5, 264.5), (237.5, 261.0), (234.5, 256.5),
                       (230.5, 252.0), (227.5, 248.5), (223.5, 244.5), (220.5, 240.5), (216.5, 236.5), (212.0, 231.5),
                       (208.5, 227.0), (204.5, 222.0), (207.5, 216.0), (210.5, 211.5), (215.0, 205.5), (220.0, 200.0)],
                      [(108.5, 219.5), (114.0, 224.0), (119.5, 230.0), (122.0, 237.0), (125.0, 244.0),
                       (128.66666666666666, 252.0), (129.33333333333334, 260.6666666666667), (132.0, 268.6666666666667),
                       (135.33333333333334, 276.6666666666667), (139.5, 283.5), (140.0, 291.3333333333333),
                       (146.0, 292.0),
                       (150.0, 291.5), (154.5, 289.5), (158.5, 288.0), (163.5, 286.5), (168.5, 286.5), (173.0, 287.0),
                       (178.5, 287.5), (182.5, 288.0), (187.0, 290.0), (193.0, 292.5), (199.5, 294.5), (204.5, 297.5),
                       (210.0, 299.0), (214.5, 302.5), (219.5, 305.5), (224.5, 308.5), (228.5, 312.5), (232.5, 316.5),
                       (235.5, 320.5), (238.5, 325.5), (239.0, 331.5), (241.5, 336.5), (244.5, 341.0), (245.0, 347.0),
                       (245.5, 353.0), (244.0, 359.5), (243.0, 366.0), (243.0, 374.0), (246.5, 380.5), (207.0, 397.0),
                       (204.0, 407.0), (206.0, 418.0), (209.0, 431.5), (211.5, 442.5), (217.0, 454.0), (223.0, 463.5),
                       (230.5, 469.5), (239.5, 474.5), (248.5, 478.0), (259.5, 485.5), (270.5, 490.0), (284.0, 493.0),
                       (297.5, 488.0), (309.0, 484.0), (319.5, 478.0), (326.5, 468.0), (332.5, 459.5), (342.5, 452.5),
                       (350.5, 446.5), (359.5, 437.5), (360.0, 424.0), (362.0, 410.5), (363.5, 397.0), (360.0, 381.5),
                       (352.5, 380.0), (343.5, 380.0), (334.0, 379.5), (326.5, 377.0), (318.5, 375.0), (309.5, 371.0),
                       (302.0, 366.5), (296.5, 361.0), (291.5, 355.0), (285.0, 347.0), (280.0, 340.5), (275.5, 334.5),
                       (271.5, 328.0), (268.5, 321.5), (265.0, 315.5), (261.5, 309.5), (258.0, 302.0), (254.5, 295.0),
                       (250.0, 289.0), (246.0, 282.5), (242.0, 276.5), (239.5, 271.0), (237.5, 265.5), (235.5, 259.0),
                       (234.0, 252.0), (234.0, 244.5), (237.0, 238.5), (240.0, 233.5), (245.0, 230.0)],
                      [(173.0, 276.0), (176.5, 280.0), (180.0, 283.5), (185.5, 285.5), (189.0, 289.5), (192.5, 295.0),
                       (195.0, 302.5), (195.5, 308.0), (193.5, 315.0), (190.5, 321.0), (186.5, 328.5), (191.5, 332.5),
                       (196.5, 330.5), (201.5, 329.5), (206.5, 328.5), (211.5, 327.5), (216.0, 327.0), (221.0, 326.5),
                       (226.0, 326.5), (231.0, 328.5), (235.5, 331.5), (239.5, 333.0), (243.5, 335.5), (247.5, 337.0),
                       (251.5, 339.5), (255.5, 341.5), (259.5, 343.0), (263.5, 345.0), (268.0, 347.0), (272.5, 349.0),
                       (275.0, 352.0), (277.5, 356.5), (279.0, 361.5), (280.5, 366.5), (280.0, 371.0), (282.0, 377.0),
                       (283.0, 382.5), (282.5, 388.0), (281.5, 395.5), (283.0, 401.0), (283.5, 408.0), (244.0, 428.0),
                       (243.0, 439.5), (244.5, 450.5), (247.0, 459.0), (252.5, 468.0), (259.5, 478.0), (266.5, 486.5),
                       (277.5, 494.0), (287.0, 498.0), (297.5, 503.5), (309.0, 506.0), (322.5, 508.5), (334.0, 508.5),
                       (347.5, 506.5), (357.5, 504.5), (366.5, 498.5), (370.0, 488.0), (376.0, 477.0), (385.0, 470.5),
                       (397.5, 467.5), (407.5, 459.5), (407.5, 444.5), (407.0, 429.5), (406.0, 412.5), (406.0, 396.5),
                       (397.0, 398.5), (388.5, 400.5), (379.0, 401.5), (370.5, 400.5), (361.0, 398.0), (353.5, 394.0),
                       (346.5, 390.0), (338.0, 386.0), (332.5, 380.0), (326.0, 374.0), (321.5, 368.5), (317.0, 361.0),
                       (312.0, 355.5), (307.5, 349.0), (303.5, 344.0), (299.0, 338.5), (294.5, 331.0), (290.0, 324.0),
                       (285.5, 316.5), (279.0, 310.5), (276.5, 303.0), (275.0, 297.5), (274.5, 290.5), (274.0, 283.0),
                       (275.0, 277.5), (277.5, 272.5), (281.0, 269.0), (287.0, 267.5), (291.0, 267.5)],
                      [(111.6, 253.6), (118.0, 256.0), (124.0, 262.4), (131.2, 268.0), (136.4, 274.4), (139.2, 281.2),
                       (142.8, 288.8), (143.2, 295.6), (146.0, 303.2), (151.6, 311.6), (149.6, 320.0), (157.5, 320.0),
                       (163.5, 318.5), (168.0, 316.0), (174.0, 313.0), (179.5, 311.5), (186.0, 310.0), (192.0, 310.0),
                       (198.5, 309.5), (202.5, 310.5), (207.0, 311.5), (212.5, 312.5), (218.0, 312.5), (224.0, 312.0),
                       (230.5, 313.0), (236.5, 315.5), (240.5, 319.5), (244.0, 323.5), (249.0, 326.0), (253.5, 329.0),
                       (257.0, 334.0), (260.0, 338.5), (262.5, 344.5), (264.5, 349.0), (264.5, 354.0), (265.5, 358.5),
                       (265.5, 363.0), (266.0, 368.5), (266.5, 373.0), (268.0, 378.5), (267.0, 384.5), (240.8, 410.8),
                       (241.2, 420.4), (244.66666666666666, 430.0), (246.4, 439.6), (252.0, 448.0), (257.5, 457.0),
                       (263.5, 465.5), (272.5, 472.5), (281.5, 476.5), (290.5, 480.5), (301.0, 483.5), (311.5, 486.0),
                       (322.5, 486.0), (332.5, 485.0), (343.0, 483.5), (353.0, 478.5), (359.5, 468.0), (365.0, 458.5),
                       (371.0, 449.5), (380.0, 442.5), (386.0, 431.5), (386.0, 416.0), (385.0, 402.5), (384.5, 388.5),
                       (379.0, 374.5), (371.5, 372.5), (364.0, 372.5), (357.5, 372.0), (350.5, 373.0), (340.8, 372.4),
                       (332.8, 370.4), (325.2, 367.6), (317.2, 364.8), (309.6, 359.2), (302.4, 354.8), (296.8, 348.8),
                       (289.6, 342.8), (283.2, 336.8), (277.2, 330.8), (273.2, 324.0), (268.8, 317.6), (264.8, 310.8),
                       (260.0, 304.8), (257.6, 296.8), (254.0, 289.2), (251.6, 282.4), (248.8, 276.8), (247.6, 270.4),
                       (246.4, 264.8), (247.2, 257.2), (249.2, 252.8), (252.0, 246.4), (256.4, 241.2), (262.8, 236.4)]])

    run(data=data)
